(function(d){d.Tools={};d.Tools.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)})};d.Tools.createCookie=function(a,c,b){if(b){var e=new Date;e.setTime(e.getTime()+864E5*b);b="; expires="+e.toGMTString()}else b="";document.cookie=a+"="+c+b+"; path=/"};d.Tools.readCookie=function(a){a+="=";for(var c=document.cookie.split(";"),b=0;b<c.length;b++){for(var e=c[b];" "==e.charAt(0);)e=e.substring(1,e.length);
if(0==e.indexOf(a))return e.substring(a.length,e.length)}return null};d.Tools.eraseCookie=function(a){createCookie(a,"",-1)}})(window.EP=window.EP||{});
(function(d){d.User=function(a,c){var b=this;b.uuid=c||d.Tools.uuid();b.name=ko.observable("");b.estimation=ko.observable(!1);b.broadcast=function(){a.emit("update",ko.toJSON(b))};b.loadFromCookie=function(){d.Tools.readCookie("ep.user.name")&&d.Tools.readCookie("ep.user.uuid")&&(b.name(d.Tools.readCookie("ep.user.name")),b.uuid=d.Tools.readCookie("ep.user.uuid"))};b.saveToCookie=function(){d.Tools.createCookie("ep.user.name",b.name());d.Tools.createCookie("ep.user.uuid",b.uuid)}};d.PokerView=function(a){var c=
this,b=function(){var a=[];c.users().forEach(function(c,b){!1!==c.estimation()&&a.push(c.estimation())});!1!==c.localUser().estimation()&&a.push(c.localUser().estimation());return a},e=function(a){for(var b=0;b<c.users().length;b++)if(c.users()[b].uuid===a)return b;return!1},f=io.connect("/");f.on("update",function(a){a=JSON.parse(a);if(void 0!==a.uuid){var b;b=e(a.uuid);b=!1===b?!1:c.users()[b];b||(b=new d.User(f,a.uuid),c.users.push(b));b.name(a.name);b.estimation(a.estimation)}else c.storyTitle(a.storyTitle)});
f.on("who is there",function(){c.localUser().broadcast();g()});f.on("user disconnected",function(a){a=e(a);c.users.splice(a,1)});f.on("new round",function(){c.localUser().estimation(!1)});c.initNewRound=function(){c.localUser().estimation(!1);f.emit("new round")};c.localUser=ko.observable(new d.User(f));c.localUser().loadFromCookie();c.localUser().name.subscribe(function(){c.localUser().broadcast();c.localUser().saveToCookie()});c.localUser().estimation.subscribe(function(){c.localUser().broadcast()});
f.emit("join",{groupName:a,userUuid:c.localUser().uuid});c.localUser().broadcast();c.users=ko.observableArray([]);c.storyTitle=ko.observable("");c.storyTitle.subscribe(function(){g()});c.highestEstimation=ko.computed(function(){var a=b(),a=Math.max.apply(null,a);return-Infinity===a?!1:a});c.lowestEstimation=ko.computed(function(){var a=b(),a=Math.min.apply(null,a);return Infinity===a?!1:a});c.estimationsComplete=ko.computed(function(){for(var a=0;a<c.users().length;a++)if(!1===c.users()[a].estimation())return!1;
return!1===c.localUser().estimation()?!1:!0});var g=function(){var a={storyTitle:c.storyTitle()};f.emit("update",JSON.stringify(a))}}})(window.EP=window.EP||{});
(function(d){d.bindingHandlers.estimationSelect={init:function(a,c){var b=[0,1,2,3,5,8,13,20,40,100];a.classList.add("estimationSelect");for(var e=0;e<b.length;e++)a.insertAdjacentHTML("beforeend",'<button type="button" class="btn">'+b[e]+"</button>");b=a.querySelectorAll("button");for(e=0;e<b.length;e++)b[e].addEventListener("click",function(){var a=c();this.classList.contains("active")?a(!1):a(+this.textContent)})},update:function(a,c){for(var b=c(),e=a.querySelectorAll("button"),d=0;d<e.length;d++)+e[d].textContent===
b()?e[d].classList.add("active"):e[d].classList.remove("active")}};d.bindingHandlers.editableText={init:function(a,c){a.classList.add("editableText");a.insertAdjacentHTML("beforeend",'<span class="et-display"><span class="et-label"></span><span class="et-hint"></span></span><span class="et-form"><input/><button type="submit" class="btn btn-sm btn-primary"><span class="glyphicon glyphicon-ok"></span></button></span>');a.querySelector(".et-form").style.display="none";var b=function(){a.classList.remove("editing");
a.querySelector(".et-display").style.display="";a.querySelector(".et-form").style.display="none";c()(a.querySelector("input").value)};a.querySelector(".et-display").addEventListener("click",function(){a.classList.add("editing");a.querySelector(".et-display").style.display="none";a.querySelector(".et-form").style.display="";a.querySelector(".et-form input").focus()});a.querySelector("button").addEventListener("click",b);a.querySelector("input").addEventListener("keypress",function(a){13===a.keyCode&&
b()});a.querySelector("input").addEventListener("keypress",function(b){27===b.keyCode&&(a.classList.remove("editing"),a.querySelector(".et-display").style.display="",a.querySelector(".et-form").style.display="none")})},update:function(a,c){var b=c();a.querySelector(".et-label").textContent=b();a.querySelector("input").value=b();b()?a.querySelector(".et-hint").style.display="none":(a.querySelector(".et-hint").textContent=a.getAttribute("data-edit-hint")||"edit",a.querySelector(".et-hint").style.display=
"")}}})(ko);(function(d){""===location.hash&&(location.hash=d.Tools.uuid());d=new d.PokerView(location.hash);ko.applyBindings(d)})(window.EP=window.EP||{});
